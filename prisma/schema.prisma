generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// ENUMS
// ============================================

enum DocumentType {
  ID_CARD            // RG
  TAX_ID             // CPF
  DRIVERS_LICENSE    // CNH
  BIRTH_CERTIFICATE  // Certidão de Nascimento
  PROOF_OF_RESIDENCE // Comprovante de Residência
  MEDICAL_REPORT     // Laudo Médico
  OTHER              // Outros
}

enum Relationship {
  FATHER
  MOTHER
  SON
  DAUGHTER
  SPOUSE
  BROTHER
  SISTER
  UNCLE
  AUNT
  GRANDFATHER
  GRANDMOTHER
  OTHER
}

// ============================================
// PERSON HIERARCHY
// ============================================

model Person {
  id                String    @id @default(uuid())
  taxId             String    @unique @map("tax_id")        // CPF
  name              String
  birthDate         DateTime  @map("birth_date")
  phone             String
  idCard            String?   @map("id_card")               // RG
  addressStreet     String?   @map("address_street")
  addressNumber     String?   @map("address_number")
  addressNeighborhood String? @map("address_neighborhood")
  addressCity       String?   @map("address_city")
  addressState      String?   @map("address_state")
  addressZipCode    String?   @map("address_zip_code")
  addressPhone      String?   @map("address_phone")
  
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")
  
  companion         Companion?
  patient           Patient?
  employee          Employee?
  documents         Document[]
  accommodations    Accommodation[]

  @@map("people")
}

model Companion {
  id        String   @id @default(uuid())
  personId  String   @unique @map("person_id")
  person    Person   @relation(fields: [personId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  patients  PatientGuardian[]

  @@map("companions")
}

model Patient {
  id              String    @id @default(uuid())
  personId        String    @unique @map("person_id")
  person          Person    @relation(fields: [personId], references: [id], onDelete: Cascade)
  medicalNotes    String?   @map("medical_notes") @db.Text
  
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")
  
  guardians       PatientGuardian[]

  @@map("patients")
}

model PatientGuardian {
  id           String       @id @default(uuid())
  companionId  String       @map("companion_id")
  patientId    String       @map("patient_id")
  relationship Relationship
  
  companion    Companion    @relation(fields: [companionId], references: [id], onDelete: Cascade)
  patient      Patient      @relation(fields: [patientId], references: [id], onDelete: Cascade)
  
  createdAt    DateTime     @default(now()) @map("created_at")
  updatedAt    DateTime     @updatedAt @map("updated_at")

  @@unique([companionId, patientId])
  @@map("patient_guardians")
}

// ============================================
// EMPLOYEE HIERARCHY
// ============================================

model Employee {
  id              String   @id @default(uuid())
  personId        String   @unique @map("person_id")
  person          Person   @relation(fields: [personId], references: [id], onDelete: Cascade)
  email           String   @unique
  password        String
  registrationNumber String @unique @map("registration_number")
  
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")
  
  driver          Driver?
  manager         Manager?

  @@map("employees")
}

model Driver {
  id         String   @id @default(uuid())
  employeeId String   @unique @map("employee_id")
  employee   Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  @@map("drivers")
}

model Manager {
  id         String   @id @default(uuid())
  employeeId String   @unique @map("employee_id")
  employee   Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  @@map("managers")
}

// ============================================
// DOCUMENTS
// ============================================

model Document {
  id         String       @id @default(uuid())
  personId   String       @map("person_id")
  person     Person       @relation(fields: [personId], references: [id], onDelete: Cascade)
  name       String
  type       DocumentType
  size       Int
  path       String
  uploadDate DateTime     @default(now()) @map("upload_date")
  
  createdAt  DateTime     @default(now()) @map("created_at")
  updatedAt  DateTime     @updatedAt @map("updated_at")

  @@map("documents")
}

// ============================================
// SUPPORT HOUSES & ACCOMMODATIONS
// ============================================

model SupportHouse {
  id             String          @id @default(uuid())
  name           String
  address        String
  phone          String?
  capacity       Int?
  
  createdAt      DateTime        @default(now()) @map("created_at")
  updatedAt      DateTime        @updatedAt @map("updated_at")
  
  accommodations Accommodation[]

  @@map("support_houses")
}

model Accommodation {
  id             String       @id @default(uuid())
  personId       String       @map("person_id")
  supportHouseId String       @map("support_house_id")
  checkInDate    DateTime     @map("check_in_date")
  checkOutDate   DateTime?    @map("check_out_date")
  
  person         Person       @relation(fields: [personId], references: [id], onDelete: Cascade)
  supportHouse   SupportHouse @relation(fields: [supportHouseId], references: [id], onDelete: Cascade)
  
  createdAt      DateTime     @default(now()) @map("created_at")
  updatedAt      DateTime     @updatedAt @map("updated_at")

  @@map("accommodations")
}

// ============================================
// VEHICLES & TRIPS
// ============================================

model Vehicle {
  id         String   @id @default(uuid())
  plate      String   @unique
  model      String
  brand      String?
  year       Int?
  capacity   Int?
  
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  @@map("vehicles")
}

model Trip {
  id              String    @id @default(uuid())
  origin          String
  destination     String
  departureDate   DateTime  @map("departure_date")
  arrivalDate     DateTime? @map("arrival_date")
  
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  @@map("trips")
}