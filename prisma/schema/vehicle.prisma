model Vehicle {
  id          String        @id @default(uuid())
  plate       String        @unique
  chassis     String        @unique
  model       String
  year        Int
  color       String
  maxCapacity Int           @map("max_capacity")
  status      VehicleStatus @default(ACTIVE)
  
  createdAt   DateTime      @default(now()) @map("created_at")
  updatedAt   DateTime      @updatedAt @map("updated_at")
  
  trips       Trip[]
  documents   VehicleDocument[]

  @@map("vehicles")
}

model Trip {
  id              String     @id @default(uuid())
  vehicleId       String     @map("vehicle_id")
  driverId        String     @map("driver_id")
  origin          String
  destination     String
  departureDate   DateTime   @map("departure_date")
  arrivalDate     DateTime?  @map("arrival_date")
  status          TripStatus @default(SCHEDULED)
  
  vehicle         Vehicle    @relation(fields: [vehicleId], references: [id], onDelete: Restrict)
  driver          Employee   @relation(fields: [driverId], references: [id], onDelete: Restrict)
  
  createdAt       DateTime   @default(now()) @map("created_at")
  updatedAt       DateTime   @updatedAt @map("updated_at")
  
  passengers         TripPassenger[]
  patientGuardians   PatientGuardian[]
  routes             TripRoute[]

  @@map("trips")
}

model TripPassenger {
  id        String   @id @default(uuid())
  tripId    String   @map("trip_id")
  personId  String   @map("person_id")
  
  trip      Trip     @relation(fields: [tripId], references: [id], onDelete: Cascade)
  person    Person   @relation(fields: [personId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@unique([tripId, personId])
  @@map("trip_passengers")
}

model TripRoute {
  id             String       @id @default(uuid())
  tripId         String       @map("trip_id")
  supportHouseId String       @map("support_house_id")
  sequence       Int
  
  trip           Trip         @relation(fields: [tripId], references: [id], onDelete: Cascade)
  supportHouse   SupportHouse @relation(fields: [supportHouseId], references: [id], onDelete: Restrict)
  
  createdAt      DateTime     @default(now()) @map("created_at")
  updatedAt      DateTime     @updatedAt @map("updated_at")

  @@unique([tripId, supportHouseId])
  @@map("trip_routes")
}

model VehicleDocument {
  id         String               @id @default(uuid())
  vehicleId  String               @map("vehicle_id")
  vehicle    Vehicle              @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  name       String
  type       VehicleDocumentType
  expiryDate DateTime?            @map("expiry_date")
  size       Int
  path       String
  uploadDate DateTime             @default(now()) @map("upload_date")
  
  createdAt  DateTime             @default(now()) @map("created_at")
  updatedAt  DateTime             @updatedAt @map("updated_at")

  @@map("vehicle_documents")
}
